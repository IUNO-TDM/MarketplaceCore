<?xml version="1.0" encoding="utf-8"?><html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><head xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="vs_targetSchema" content="http://schemas.microsoft.com/intellisense/ie5" /><link rel="stylesheet" href="sqlspec.css" /><title>MarketplaceCore - public.settechnologydata</title><script language="JavaScript" src="resort_table.js"></script><script language="javascript">
//
// this hides the SVG if you are on IE, 
// and hides the VML if you are NOT on IE.
//
function init()
{
  var isIE = navigator.userAgent.indexOf("MSIE") != -1;
  showhideIfIE('FK_SVG', isIE, true);
  showhideIfIE('DEPENDENCY_SVG', isIE, true);
  showhideIfIE('MODEL_SVG', isIE, true); 
  showhideIfIE('FK_VML', isIE, false);
  showhideIfIE('DEPENDENCY_VML', isIE, false);
  showhideIfIE('MODEL_VML', isIE, false);
  
  var node = document.getElementById('copy_url_div');
  if (node != null)
  {
    var inChm = document.URL.indexOf('mk:@MSITStore') != -1;
    node.style.display = inChm || !isIE ? 'none' : 'block';
  }
}   

function showhideIfIE(elementName, isIE, hide)
{
  node = document.getElementById(elementName);
  if (node != null) 
  {
    if (hide) 
      node.style.display = isIE ? 'none' : 'block';
    else
      node.style.display = isIE ? 'block' : 'none';
  }
}

function copyToClipboard(s)
{
  if(window.clipboardData)
    if (clipboardData.setData)
      clipboardData.setData('text', s);
}
</script></head><body onload="init()"><div id="nsbanner" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><div id="bannerrow1"><table class="bannerparthead" cellspacing="0" id="Table1"><tr id="hdr"><td class="runninghead">Database reference - MarketplaceCore</td><td class="product" /></tr></table></div><div id="TitleRow"><h1 class="dtH1"><a href="default.htm">MarketplaceCore</a> -         
                    <a href="allUDFs.htm">functions</a> -         
                    public.settechnologydata</h1></div></div><div id="nstext"><h2 class="dtH2" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><font color="red">Evaluation</font></h2><p xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><font color="red"><b>This is an evaluation version of SqlSpec.  If you like SqlSpec, please consider upgrading to the full version.  Upgrade here:  <a target="_blank" href="http://elsasoft.com">Upgrade</a></b></font></p><h2 class="dtH2">Description</h2><span class="desc">none</span><h2 class="dtH2" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><font color="red">Evaluation</font></h2><p xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><font color="red"><b>This is an evaluation version of SqlSpec.  If you like SqlSpec, please consider upgrading to the full version.  Upgrade here:  <a target="_blank" href="http://elsasoft.com">Upgrade</a></b></font></p><h2 class="dtH2">Function properties</h2><table class="dtTABLE"><thead><tr valign="top"><th style="cursor:pointer;cursor:hand;" onclick="resortColumn(this)">name</th><th style="cursor:pointer;cursor:hand;" onclick="resortColumn(this)">value</th></tr></thead><tbody><tr valign="top"><td>name</td><td>public.settechnologydata</td></tr><tr valign="top"><td>return type</td><td>pg_catalog.record 
                  </td></tr><tr valign="top"><td>language</td><td>PLPGSQL</td></tr><tr valign="top"><td>deterministic</td><td>NO</td></tr></tbody></table><h2 class="dtH2" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><font color="red">Evaluation</font></h2><p xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><font color="red"><b>This is an evaluation version of SqlSpec.  If you like SqlSpec, please consider upgrading to the full version.  Upgrade here:  <a target="_blank" href="http://elsasoft.com">Upgrade</a></b></font></p><h2 class="dtH2">Parameters</h2><table class="dtTABLE"><thead><tr valign="top"><th style="cursor:pointer;cursor:hand;" onclick="resortColumn(this)">name</th><th style="cursor:pointer;cursor:hand;" onclick="resortColumn(this)">datatype</th><th style="cursor:pointer;cursor:hand;" onclick="resortColumn(this)">udt</th><th style="cursor:pointer;cursor:hand;" onclick="resortColumn(this)">in/out</th></tr></thead><tbody><tr valign="top"><td>vtechnologydataname 
                                            </td><td>character varying 
                                            </td><td>pg_catalog.varchar 
                                            </td><td>IN 
                                            </td></tr><tr valign="top"><td>vtechnologydata 
                                            </td><td>character varying 
                                            </td><td>pg_catalog.varchar 
                                            </td><td>IN 
                                            </td></tr><tr valign="top"><td>vtechnologydatadescription 
                                            </td><td>character varying 
                                            </td><td>pg_catalog.varchar 
                                            </td><td>IN 
                                            </td></tr><tr valign="top"><td>vtechnologyuuid 
                                            </td><td>uuid 
                                            </td><td>pg_catalog.uuid 
                                            </td><td>IN 
                                            </td></tr><tr valign="top"><td>vlicensefee 
                                            </td><td>integer 
                                            </td><td>pg_catalog.int4 
                                            </td><td>IN 
                                            </td></tr><tr valign="top"><td>vproductcode 
                                            </td><td>integer 
                                            </td><td>pg_catalog.int4 
                                            </td><td>IN 
                                            </td></tr><tr valign="top"><td>vtaglist 
                                            </td><td>ARRAY 
                                            </td><td>pg_catalog._text 
                                            </td><td>IN 
                                            </td></tr><tr valign="top"><td>vcomponentlist 
                                            </td><td>ARRAY 
                                            </td><td>pg_catalog._text 
                                            </td><td>IN 
                                            </td></tr><tr valign="top"><td>vtechnologydataimgref 
                                            </td><td>text 
                                            </td><td>pg_catalog.text 
                                            </td><td>IN 
                                            </td></tr><tr valign="top"><td>vcreatedby 
                                            </td><td>uuid 
                                            </td><td>pg_catalog.uuid 
                                            </td><td>IN 
                                            </td></tr><tr valign="top"><td>vroles 
                                            </td><td>ARRAY 
                                            </td><td>pg_catalog._text 
                                            </td><td>IN 
                                            </td></tr><tr valign="top"><td>technologydatauuid 
                                            </td><td>uuid 
                                            </td><td>pg_catalog.uuid 
                                            </td><td>OUT 
                                            </td></tr><tr valign="top"><td>technologydataname 
                                            </td><td>character varying 
                                            </td><td>pg_catalog.varchar 
                                            </td><td>OUT 
                                            </td></tr><tr valign="top"><td>technologyuuid 
                                            </td><td>uuid 
                                            </td><td>pg_catalog.uuid 
                                            </td><td>OUT 
                                            </td></tr><tr valign="top"><td>technologydata 
                                            </td><td>character varying 
                                            </td><td>pg_catalog.varchar 
                                            </td><td>OUT 
                                            </td></tr><tr valign="top"><td>licensefee 
                                            </td><td>bigint 
                                            </td><td>pg_catalog.int8 
                                            </td><td>OUT 
                                            </td></tr><tr valign="top"><td>productcode 
                                            </td><td>integer 
                                            </td><td>pg_catalog.int4 
                                            </td><td>OUT 
                                            </td></tr><tr valign="top"><td>technologydatadescription 
                                            </td><td>character varying 
                                            </td><td>pg_catalog.varchar 
                                            </td><td>OUT 
                                            </td></tr><tr valign="top"><td>technologydatathumbnail 
                                            </td><td>bytea 
                                            </td><td>pg_catalog.bytea 
                                            </td><td>OUT 
                                            </td></tr><tr valign="top"><td>technologydataimgref 
                                            </td><td>character varying 
                                            </td><td>pg_catalog.varchar 
                                            </td><td>OUT 
                                            </td></tr><tr valign="top"><td>taglist 
                                            </td><td>ARRAY 
                                            </td><td>pg_catalog._uuid 
                                            </td><td>OUT 
                                            </td></tr><tr valign="top"><td>componentlist 
                                            </td><td>ARRAY 
                                            </td><td>pg_catalog._uuid 
                                            </td><td>OUT 
                                            </td></tr><tr valign="top"><td>createdat 
                                            </td><td>timestamp with time zone 
                                            </td><td>pg_catalog.timestamptz 
                                            </td><td>OUT 
                                            </td></tr><tr valign="top"><td>createdby 
                                            </td><td>uuid 
                                            </td><td>pg_catalog.uuid 
                                            </td><td>OUT 
                                            </td></tr></tbody></table><h2 class="dtH2" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><font color="red">Evaluation</font></h2><p xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><font color="red"><b>This is an evaluation version of SqlSpec.  If you like SqlSpec, please consider upgrading to the full version.  Upgrade here:  <a target="_blank" href="http://elsasoft.com">Upgrade</a></b></font></p><h2 class="dtH2">Usage</h2><pre class="csharpcode"><span class="kwrd">result</span> = <span class="kwrd">public</span>.settechnologydata(
    my_vtechnologydataname,
    my_vtechnologydata,
    my_vtechnologydatadescription,
    my_vtechnologyuuid,
    my_vlicensefee,
    my_vproductcode,
    my_vtaglist,
    my_vcomponentlist,
    my_vtechnologydataimgref,
    my_vcreatedby,
    my_vroles,
    my_technologydatauuid,
    my_technologydataname,
    my_technologyuuid,
    my_technologydata,
    my_licensefee,
    my_productcode,
    my_technologydatadescription,
    my_technologydatathumbnail,
    my_technologydataimgref,
    my_taglist,
    my_componentlist,
    my_createdat,
    my_createdby
);</pre><h2 class="dtH2" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><font color="red">Evaluation</font></h2><p xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><font color="red"><b>This is an evaluation version of SqlSpec.  If you like SqlSpec, please consider upgrading to the full version.  Upgrade here:  <a target="_blank" href="http://elsasoft.com">Upgrade</a></b></font></p><h2 class="dtH2">Code</h2><pre class="csharpcode"><span class="kwrd">CREATE</span> <span class="kwrd">FUNCTION</span> settechnologydata(vtechnologydataname <span class="kwrd">character</span> <span class="kwrd">varying</span>, vtechnologydata <span class="kwrd">character</span> <span class="kwrd">varying</span>, vtechnologydatadescription <span class="kwrd">character</span> <span class="kwrd">varying</span>, vtechnologyuuid uuid, vlicensefee <span class="kwrd">integer</span>, vproductcode <span class="kwrd">integer</span>, vtaglist text[], vcomponentlist text[], vtechnologydataimgref text, vcreatedby uuid, vroles text[]) <span class="kwrd">RETURNS</span> <span class="kwrd">TABLE</span>(technologydatauuid uuid, technologydataname <span class="kwrd">character</span> <span class="kwrd">varying</span>, technologyuuid uuid, technologydata <span class="kwrd">character</span> <span class="kwrd">varying</span>, licensefee bigint, productcode <span class="kwrd">integer</span>, technologydatadescription <span class="kwrd">character</span> <span class="kwrd">varying</span>, technologydatathumbnail bytea, technologydataimgref <span class="kwrd">character</span> <span class="kwrd">varying</span>, taglist uuid[], componentlist uuid[], createdat <span class="kwrd">timestamp</span> <span class="kwrd">with</span> <span class="kwrd">time</span> <span class="kwrd">zone</span>, createdby uuid)
    <span class="kwrd">LANGUAGE</span> plpgsql
    <span class="kwrd">AS</span> $$

        #variable_conflict use_column

          <span class="kwrd">DECLARE</span>     vCompUUID uuid;

                    vTagName text;

                    vTechnologyDataID <span class="kwrd">int</span>;

                    vTechnologyDataUUID uuid;

                    vTechnologyID <span class="kwrd">integer</span> := (<span class="kwrd">select</span> technologyID <span class="kwrd">from</span> technologies <span class="kwrd">where</span> technologyUUID = vTechnologyUUID);

                    vFunctionName <span class="kwrd">varchar</span> := <span class="str">'SetTechnologyData'</span>;

                    vIsAllowed <span class="kwrd">boolean</span> := (<span class="kwrd">select</span> <span class="kwrd">public</span>.checkPermissions(vRoles, vFunctionName));

                    vAlreadExists <span class="kwrd">integer</span> := (<span class="kwrd">select</span> 1 <span class="kwrd">from</span> technologydata <span class="kwrd">where</span> technologydataname = vtechnologydataname <span class="kwrd">and</span> deleted <span class="kwrd">is</span> <span class="kwrd">null</span>);



        <span class="kwrd">BEGIN</span>



        <span class="kwrd">IF</span>(vIsAllowed) <span class="kwrd">THEN</span>

            <span class="rem">-- Proof if all components are avaiable</span>

            FOREACH vCompUUID <span class="kwrd">in</span> <span class="kwrd">array</span> vComponentlist

            LOOP

                 <span class="kwrd">if</span> <span class="kwrd">not</span> <span class="kwrd">exists</span> (<span class="kwrd">select</span> componentid <span class="kwrd">from</span> components <span class="kwrd">where</span> componentuuid = vCompUUID) <span class="kwrd">then</span>

                 raise <span class="kwrd">exception</span> <span class="kwrd">using</span>

                 errcode = <span class="str">'invalid_parameter_value'</span>,

                 message = <span class="str">'There is no component with ComponentName: '</span> || <span class="kwrd">cast</span>(vCompUUID <span class="kwrd">as</span> <span class="kwrd">varchar</span>);

                 <span class="kwrd">end</span> <span class="kwrd">if</span>;

            <span class="kwrd">END</span> LOOP;

            <span class="rem">-- Proof if all Tags are avaiable</span>

            <span class="kwrd">IF</span> (vTagList != <span class="kwrd">null</span>) <span class="kwrd">THEN</span>

                FOREACH vTagName <span class="kwrd">in</span> <span class="kwrd">array</span> vTagList

                LOOP

                     <span class="kwrd">if</span> <span class="kwrd">not</span> <span class="kwrd">exists</span> (<span class="kwrd">select</span> tagID <span class="kwrd">from</span> tags <span class="kwrd">where</span> tagname = vTagName) <span class="kwrd">then</span>

                        perform <span class="kwrd">public</span>.createtag(vTagName,vCreatedby, vRoles);

                     <span class="kwrd">end</span> <span class="kwrd">if</span>;

                <span class="kwrd">END</span> LOOP;

            <span class="kwrd">END</span> <span class="kwrd">IF</span>;

            <span class="rem">-- Proof if technology is avaiable</span>

            <span class="kwrd">if</span> <span class="kwrd">not</span> <span class="kwrd">exists</span> (<span class="kwrd">select</span> technologyid <span class="kwrd">from</span> technologies <span class="kwrd">where</span> technologyuuid = vTechnologyUUID) <span class="kwrd">then</span>

                raise <span class="kwrd">exception</span> <span class="kwrd">using</span>

                errcode = <span class="str">'invalid_parameter_value'</span>,

                message = <span class="str">'There is no technology with TechnologyID: '</span> || <span class="kwrd">coalesce</span>(vTechnologyID::text,<span class="str">'Empty'</span>);

            <span class="kwrd">end</span> <span class="kwrd">if</span>;



            <span class="rem">-- Create new TechnologyData</span>

                <span class="kwrd">IF</span>(vAlreadExists <span class="kwrd">is</span> <span class="kwrd">null</span>) <span class="kwrd">THEN</span>

                    perform <span class="kwrd">public</span>.createtechnologydata(vTechnologyDataName, vTechnologyData, vTechnologyDataDescription, vLicenseFee, vProductCode,                     vTechnologyUUID, vtechnologydataimgref, vCreatedBy, vRoles);

                    vTechnologyDataID := (<span class="kwrd">select</span> currval(<span class="str">'TechnologyDataID'</span>));

                    vTechnologyDataUUID := (<span class="kwrd">select</span> technologydatauuid <span class="kwrd">from</span> technologydata <span class="kwrd">where</span> technologydataid = vTechnologyDataID);



                    <span class="rem">-- Create relation from Components to TechnologyData</span>

                    perform <span class="kwrd">public</span>.CreateTechnologyDataComponents(vTechnologyDataUUID, vComponentList, vRoles);



                    <span class="rem">-- Create relation from Tags to TechnologyData</span>

                    <span class="kwrd">IF</span> (vTagList != <span class="kwrd">null</span>) <span class="kwrd">THEN</span>

                        perform <span class="kwrd">public</span>.CreateTechnologyDataTags(vTechnologyDataUUID, vTagList, CreatedBy, vRoles);

                    <span class="kwrd">END</span> <span class="kwrd">IF</span>;

                <span class="kwrd">ELSE</span>

                    RAISE <span class="kwrd">EXCEPTION</span> <span class="str">'%'</span>, <span class="str">'Technologydata already exists'</span>;

                    <span class="kwrd">RETURN</span>;



            <span class="kwrd">END</span> <span class="kwrd">IF</span>;

            <span class="rem">-- Begin Log if success</span>

            perform <span class="kwrd">public</span>.createlog(0,<span class="str">'Set TechnologyData sucessfully'</span>, <span class="str">'SetTechnologyData'</span>,

                        <span class="str">'TechnologyDataID: '</span> || <span class="kwrd">cast</span>(vTechnologyDataID <span class="kwrd">as</span> <span class="kwrd">varchar</span>) || <span class="str">', TechnologyDataName: '</span>

                        || replace(vTechnologyDataName, <span class="str">''</span><span class="str">''</span>, <span class="str">''</span><span class="str">''</span><span class="str">''</span>) || <span class="str">', TechnologyData: '</span> || vTechnologyData

                        || <span class="str">', TechnologyDataDescription: '</span> || replace(vTechnologyDataDescription, <span class="str">''</span><span class="str">''</span>, <span class="str">''</span><span class="str">''</span><span class="str">''</span>)

                        || <span class="str">', CreatedBy: '</span> || <span class="kwrd">cast</span>(vRoles <span class="kwrd">as</span> <span class="kwrd">varchar</span>));



        <span class="kwrd">ELSE</span>

             RAISE <span class="kwrd">EXCEPTION</span> <span class="str">'%'</span>, <span class="str">'Insufficiency rigths'</span>;

             <span class="kwrd">RETURN</span>;

        <span class="kwrd">END</span> <span class="kwrd">IF</span>;

        <span class="rem">-- End Log if success</span>

        <span class="rem">-- Return vTechnologyDataUUID</span>

        <span class="kwrd">RETURN</span> QUERY (

            <span class="kwrd">select</span>     TechnologyDataUUID,

                td.TechnologyDataName,

                vTechnologyUUID,

                TechnologyData,

                LicenseFee,

                ProductCode,

                TechnologyDataDescription,

                TechnologyDataThumbnail,

                TechnologyDataImgRef,

                array_agg(tg.taguuid) <span class="kwrd">as</span> TagList,

                array_agg(co.componentuuid) <span class="kwrd">as</span> ComponentList,

                td.CreatedAt <span class="kwrd">at</span> <span class="kwrd">time</span> <span class="kwrd">zone</span> <span class="str">'utc'</span>,

                vCreatedBy <span class="kwrd">as</span> CreatedBy

            <span class="kwrd">from</span> technologydata td

            <span class="kwrd">left</span> <span class="kwrd">outer</span> <span class="kwrd">join</span> technologydatatags tt <span class="kwrd">on</span>

            td.technologydataid = tt.technologydataid

            <span class="kwrd">left</span> <span class="kwrd">outer</span> <span class="kwrd">join</span> tags tg <span class="kwrd">on</span> tt.tagid = tg.tagid

            <span class="kwrd">join</span> technologydatacomponents tc

            <span class="kwrd">on</span> tc.technologydataid = td.technologydataid

            <span class="kwrd">join</span> components co

            <span class="kwrd">on</span> co.componentid = tc.componentid

            <span class="kwrd">where</span> td.technologydataid = vTechnologyDataID

            <span class="kwrd">group</span> <span class="kwrd">by</span> technologydatauuid, td.technologydataname, technologydata,

                 licensefee, productcode, technologydatadescription, technologydatathumbnail,

                 TechnologyDataImgRef, td.createdat, td.createdby

        );



        <span class="kwrd">exception</span> <span class="kwrd">when</span> others <span class="kwrd">then</span>

        <span class="rem">-- Begin Log if error</span>

        perform <span class="kwrd">public</span>.createlog(1,<span class="str">'ERROR: '</span> || SQLERRM || <span class="str">' '</span> || <span class="kwrd">SQLSTATE</span>,  <span class="str">'SetTechnologyData'</span>,

                    <span class="str">'TechnologyDataID: '</span> || <span class="kwrd">cast</span>(vTechnologyDataID <span class="kwrd">as</span> <span class="kwrd">varchar</span>) || <span class="str">', TechnologyDataName: '</span>

                    || replace(vTechnologyDataName, <span class="str">''</span><span class="str">''</span>, <span class="str">''</span><span class="str">''</span><span class="str">''</span>) || <span class="str">', TechnologyData: '</span> || vTechnologyData

                    || <span class="str">', TechnologyDataDescription: '</span> || replace(vTechnologyDataDescription, <span class="str">''</span><span class="str">''</span>, <span class="str">''</span><span class="str">''</span><span class="str">''</span>)

                    || <span class="str">', CreatedBy: '</span> || <span class="kwrd">cast</span>(vCreatedby <span class="kwrd">as</span> <span class="kwrd">varchar</span>));

        <span class="rem">-- End Log if error</span>

        RAISE <span class="kwrd">EXCEPTION</span> <span class="str">'%'</span>, <span class="str">'ERROR: '</span> || SQLERRM || <span class="str">' '</span> || <span class="kwrd">SQLSTATE</span> || <span class="str">' at SetTechnologyData'</span>;

        <span class="kwrd">RETURN</span>;

          <span class="kwrd">END</span>;

      $$;


</pre></div><p style="page-break-after:always" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><br /><br /><div id="copy_url_div"><center><a href="javascript:void(0)" onclick="copyToClipboard(document.URL)">copy URL to clipboard (IE only)</a></center><br /></div><center>Documentation generated by <a target="_blank" href="http://elsasoft.com">SqlSpec</a></center></p></body></html>